name: Deploy to Production

on:
  workflow_dispatch:
    inputs:
      ref:
        description: 'Guidelines use this workflows :
- If you want to push into production server input ''main'' on column
- if  you want revert input SHA tags (e.g. e6a1b1d you wil be revert this prev commits)'
        required: true
        default: 'main'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3
      with:
        ref: ${{ github.event.inputs.ref }}

    - name: Setup SSH Connection
      uses: webfactory/ssh-agent@v0.5.3
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}

    - name: Deploy Code to Production cPanel
      run: |
        ssh -o StrictHostKeyChecking=no ${{ secrets.SSH_USER }}@${{ secrets.SSH_HOST }} "
          cd ${{ secrets.DEPLOY_PATH_PROD }} &&
          git fetch origin &&
          git checkout ${{ github.event.inputs.ref }}
        "